<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otto - Zen Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        paper: {
                            bg: '#f8f8f8', // Off-white
                            ink: '#1a1a1a', // Near-black
                            sub: '#888888', // Gray
                            accent: '#eb3b3b', // Red highlight
                            success: '#10b981', // Green
                            highlight: '#ffffff', // Pure white
                        },
                        void: {
                            bg: '#09090b', // Zinc 950
                            ring: '#27272a', // Zinc 800
                            text: '#e4e4e7', // Zinc 200
                        }
                    },
                    fontFamily: {
                        sans: ['"Inter"', 'sans-serif'],
                        mono: ['"IBM Plex Mono"', 'monospace'],
                    },
                    animation: {
                        'breathe-left': 'breatheLeft 8s ease-in-out infinite',
                        'breathe-right': 'breatheRight 8s ease-in-out infinite',
                        'pulse-dot': 'pulseDot 3s ease-in-out infinite',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                    },
                    keyframes: {
                        breatheLeft: {
                            '0%, 100%': { transform: 'scale(1) translateX(0)', opacity: '0.1' },
                            '50%': { transform: 'scale(1.05) translateX(-20px)', opacity: '0.15' },
                        },
                        breatheRight: {
                            '0%, 100%': { transform: 'scale(1) translateX(0)', opacity: '0.1' },
                            '50%': { transform: 'scale(1.05) translateX(20px)', opacity: '0.15' },
                        },
                        pulseDot: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '1' },
                            '50%': { transform: 'scale(0.8)', opacity: '0.5' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500&family=Inter:wght@200;300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f8f8f8;
            color: #1a1a1a;
            /* Subtle Grain Texture */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
            overflow: hidden; /* App feel */
        }
        
        .view-transition {
            transition: opacity 0.3s ease-out, transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Command Palette Backdrop Blur */
        .backdrop-blur-md {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
    </style>
</head>
<body class="h-screen w-screen font-sans relative selection:bg-paper-ink/10 selection:text-paper-ink">

    <!-- App State Root -->
    <div id="app" class="relative w-full h-full flex flex-col">

        <!-- GLOBAL: Ambient Rings (Always Present, Subtle) -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-0 overflow-hidden">
            <!-- Left Ring -->
            <div class="absolute left-[-20%] md:left-[5%] lg:left-[10%] w-[50vh] h-[50vh] md:w-[60vh] md:h-[60vh] border border-paper-ink rounded-full animate-breathe-left opacity-10"></div>
            <!-- Right Ring -->
            <div class="absolute right-[-20%] md:right-[5%] lg:right-[10%] w-[50vh] h-[50vh] md:w-[60vh] md:h-[60vh] border border-paper-ink rounded-full animate-breathe-right animation-delay-1000 opacity-10"></div>
        </div>

        <!-- VIEW: Zen Home (Default) -->
        <div id="view-home" class="view-transition absolute inset-0 flex flex-col items-center justify-center z-10">
            <!-- Status Dot -->
            <div class="mb-12 cursor-pointer group" onclick="app.toggleTheme()">
                <div class="w-3 h-3 rounded-full bg-paper-accent animate-pulse-dot shadow-[0_0_15px_rgba(235,59,59,0.4)] group-hover:bg-paper-ink transition-colors"></div>
                <div class="absolute -top-8 opacity-0 group-hover:opacity-100 transition-opacity text-[10px] font-mono uppercase tracking-widest text-paper-sub transform -translate-x-1/2 left-1/2 whitespace-nowrap">
                    Toggle Theme
                </div>
            </div>

            <!-- Clock -->
            <h1 class="text-6xl md:text-8xl font-light tracking-tighter text-paper-ink mb-4 select-none transition-all duration-300">
                10:42
            </h1>
            
            <p class="text-xs md:text-sm font-mono text-paper-sub uppercase tracking-widest mb-12 md:mb-20 select-none">
                System Active
            </p>

            <!-- Command Bar (Always Visible) -->
            <div class="w-full max-w-[90%] md:max-w-lg relative group transition-all duration-500 transform translate-y-0 opacity-100" id="home-cmd-bar">
                <div class="absolute inset-0 bg-white shadow-xl rounded-2xl transform scale-100 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                <div class="relative bg-white border border-paper-ink/10 rounded-2xl flex items-center p-2 shadow-sm group-hover:shadow-md transition-shadow active:scale-[0.98] duration-200">
                    
                    <div class="w-10 h-10 flex items-center justify-center text-paper-sub">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    
                    <input 
                        type="text" 
                        placeholder="Ask Otto..." 
                        class="flex-1 bg-transparent border-none outline-none text-base md:text-lg text-paper-ink placeholder-paper-sub/50 px-2 md:px-4 h-12 font-light cursor-pointer select-none"
                        readonly
                        onclick="app.openCommandPalette()"
                    >

                    <div class="pr-4 text-xs font-mono text-paper-sub/40 hidden sm:block whitespace-nowrap">
                        CMD+K
                    </div>

                </div>
            </div>
        </div>

        <!-- VIEW: Chat -->
        <div id="view-chat" class="view-transition absolute inset-0 flex flex-col z-10 opacity-0 pointer-events-none translate-y-4 pt-20 px-4 md:px-20 pb-10 bg-paper-bg/95 backdrop-blur-sm">
             <div class="w-full max-w-3xl mx-auto h-full flex flex-col relative">
                <header class="flex items-end justify-between mb-6 border-b border-paper-ink/10 pb-4">
                    <div>
                        <h2 class="text-4xl font-light text-paper-ink mb-2">Otto</h2>
                        <p class="text-sm text-paper-sub font-mono">Chat Session #442</p>
                    </div>
                    <button onclick="app.navigate('home')" class="text-xs font-mono uppercase tracking-widest text-paper-sub hover:text-paper-ink transition-colors">
                        ESC / Back
                    </button>
                </header>

                <!-- Messages -->
                <div class="flex-1 overflow-y-auto hide-scrollbar space-y-8 pr-4 pb-20">
                    
                    <!-- Bot Message -->
                    <div class="flex gap-4">
                        <div class="w-8 h-8 rounded-full bg-paper-ink text-paper-bg flex items-center justify-center text-xs font-mono shrink-0">O</div>
                        <div class="space-y-2">
                            <p class="text-paper-ink font-light leading-relaxed">
                                I've completed the system health check. All services are running within normal parameters.
                            </p>
                            <div class="text-xs text-paper-sub font-mono bg-paper-ink/5 p-2 rounded inline-block">
                                > CPU: 12% | MEM: 4.2GB
                            </div>
                        </div>
                    </div>

                    <!-- User Message -->
                    <div class="flex gap-4 flex-row-reverse">
                         <div class="w-8 h-8 rounded-full bg-paper-accent text-paper-highlight flex items-center justify-center text-xs font-mono shrink-0">M</div>
                        <div class="space-y-2 text-right">
                            <p class="text-paper-ink font-light leading-relaxed bg-white border border-paper-ink/10 p-4 rounded-2xl rounded-tr-sm shadow-sm inline-block text-left">
                                Great. Can you draft a summary of the pending tasks for today?
                            </p>
                        </div>
                    </div>

                     <!-- Bot Message (Typing) -->
                     <div class="flex gap-4 opacity-50">
                        <div class="w-8 h-8 rounded-full bg-paper-ink text-paper-bg flex items-center justify-center text-xs font-mono shrink-0">O</div>
                        <div class="flex items-center gap-1 h-8">
                            <div class="w-1.5 h-1.5 bg-paper-sub rounded-full animate-bounce"></div>
                            <div class="w-1.5 h-1.5 bg-paper-sub rounded-full animate-bounce animation-delay-200"></div>
                            <div class="w-1.5 h-1.5 bg-paper-sub rounded-full animate-bounce animation-delay-400"></div>
                        </div>
                    </div>

                </div>

                <!-- Input (Floating) -->
                <div class="absolute bottom-0 left-0 right-0 bg-paper-bg/80 backdrop-blur-md pt-4">
                    <div class="relative group">
                        <input 
                            type="text" 
                            placeholder="Message Otto..." 
                            class="w-full bg-white border border-paper-ink/10 rounded-xl px-4 py-4 text-paper-ink placeholder-paper-sub/50 focus:outline-none focus:border-paper-ink/30 transition-all shadow-sm"
                        >
                         <button class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-paper-sub hover:text-paper-ink transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        </button>
                    </div>
                </div>

             </div>
        </div>

        <!-- VIEW: Jobs Monitor -->
        <div id="view-jobs" class="view-transition absolute inset-0 flex flex-col z-10 opacity-0 pointer-events-none translate-y-4 pt-20 px-4 md:px-20 pb-10 bg-paper-bg/95 backdrop-blur-sm">
             <div class="w-full max-w-4xl mx-auto h-full flex flex-col">
                <header class="flex items-end justify-between mb-10 border-b border-paper-ink/10 pb-4">
                    <div>
                        <h2 class="text-4xl font-light text-paper-ink mb-2">Job Queue</h2>
                        <p class="text-sm text-paper-sub font-mono">3 Active &bull; 12 Scheduled</p>
                    </div>
                    <button onclick="app.navigate('home')" class="text-xs font-mono uppercase tracking-widest text-paper-sub hover:text-paper-ink transition-colors">
                        ESC / Back
                    </button>
                </header>

                <div class="flex-1 overflow-y-auto hide-scrollbar space-y-4 pr-2">
                    <!-- Active Job Card -->
                    <div class="bg-white border border-paper-ink/5 p-6 rounded-xl flex items-center justify-between shadow-sm group hover:border-paper-ink/20 transition-all cursor-pointer" onclick="app.openJobDetail('job-123')">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-paper-accent/10 flex items-center justify-center text-paper-accent">
                                <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-light text-paper-ink">Backup Assets</h3>
                                <p class="text-xs text-paper-sub font-mono uppercase tracking-wide">Running - 45s</p>
                            </div>
                        </div>
                        <div class="text-right">
                             <button class="px-4 py-2 text-xs font-mono uppercase tracking-widest text-paper-sub hover:text-paper-accent border border-transparent hover:border-paper-ink/10 rounded transition-all" onclick="event.stopPropagation()">
                                Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Scheduled Job Card -->
                    <div class="bg-white border border-paper-ink/5 p-6 rounded-xl flex items-center justify-between shadow-sm group hover:border-paper-ink/20 transition-all opacity-70 cursor-pointer" onclick="app.openJobDetail('job-456')">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-paper-ink/5 flex items-center justify-center text-paper-ink/40">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-light text-paper-ink">Daily Digest</h3>
                                <p class="text-xs text-paper-sub font-mono uppercase tracking-wide">Scheduled - 18:00</p>
                            </div>
                        </div>
                        <div class="text-right">
                             <button class="px-4 py-2 text-xs font-mono uppercase tracking-widest text-paper-sub hover:text-paper-ink border border-transparent hover:border-paper-ink/10 rounded transition-all" onclick="event.stopPropagation()">
                                Edit
                            </button>
                        </div>
                    </div>
                </div>
             </div>
        </div>

        <!-- OVERLAY: Job Detail Slide-Over -->
        <div id="job-detail" class="fixed inset-y-0 right-0 z-40 w-full md:w-[600px] bg-white shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col border-l border-paper-ink/5">
            <div class="p-6 border-b border-paper-ink/5 flex items-center justify-between bg-paper-bg/50">
                <div>
                    <div class="text-xs font-mono text-paper-sub uppercase tracking-widest mb-1">Job ID: job-123</div>
                    <h2 class="text-2xl font-light text-paper-ink">Backup Assets</h2>
                </div>
                <button onclick="app.closeJobDetail()" class="p-2 hover:bg-paper-ink/5 rounded-full transition-colors">
                    <svg class="w-6 h-6 text-paper-sub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6 space-y-8">
                <!-- Status Block -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-paper-bg rounded-lg border border-paper-ink/5">
                        <div class="text-xs font-mono text-paper-sub uppercase mb-1">Status</div>
                        <div class="text-paper-accent font-mono flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-paper-accent animate-pulse"></span>
                            RUNNING
                        </div>
                    </div>
                    <div class="p-4 bg-paper-bg rounded-lg border border-paper-ink/5">
                        <div class="text-xs font-mono text-paper-sub uppercase mb-1">Duration</div>
                        <div class="text-paper-ink font-mono">00:00:45</div>
                    </div>
                </div>

                <!-- Logs Console -->
                <div>
                    <h3 class="text-sm font-medium text-paper-ink mb-3">Live Logs</h3>
                    <div class="bg-paper-bg text-paper-ink p-4 rounded-lg font-mono text-xs h-64 overflow-y-auto space-y-1 border border-paper-ink/10 shadow-inner">
                        <div class="text-paper-sub">[10:42:01] Initializing backup routine...</div>
                        <div class="text-paper-sub">[10:42:02] Connected to S3 bucket 'otto-backups'</div>
                        <div class="text-paper-sub">[10:42:05] Compressing /data/db...</div>
                        <div class="text-paper-success">[10:42:15] Uploading chunk 1/4 (25MB)...</div>
                        <div class="text-paper-accent animate-pulse">_</div>
                    </div>
                </div>

                <!-- Payload Config -->
                <div>
                    <h3 class="text-sm font-medium text-paper-ink mb-3">Configuration Payload</h3>
                    <div class="bg-white p-4 rounded-lg border border-paper-ink/10 font-mono text-xs text-paper-sub overflow-x-auto shadow-sm">
                        <pre>{
  "target": "s3",
  "compression": "gzip",
  "paths": [
    "/data/db",
    "/data/uploads"
  ],
  "retention": "30d"
}</pre>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-paper-ink/5 bg-paper-bg/50 flex justify-end gap-4">
                <button class="px-4 py-2 text-sm text-paper-ink hover:bg-paper-ink/5 rounded-lg transition-colors" onclick="app.navigate('audit'); app.closeJobDetail()">View Audit Trail</button>
                <button class="px-6 py-2 bg-paper-ink text-white text-sm rounded-lg hover:bg-paper-ink/90 transition-colors shadow-lg shadow-paper-ink/20">Restart Job</button>
            </div>
        </div>

        <!-- VIEW: Audit Trail -->
        <div id="view-audit" class="view-transition absolute inset-0 flex flex-col z-10 opacity-0 pointer-events-none translate-y-4 pt-20 px-4 md:px-20 pb-10 bg-paper-bg/95 backdrop-blur-sm">
             <div class="w-full max-w-5xl mx-auto h-full flex flex-col">
                <header class="flex items-end justify-between mb-10 border-b border-paper-ink/10 pb-4">
                    <div>
                        <h2 class="text-4xl font-light text-paper-ink mb-2">Execution Log</h2>
                        <p class="text-sm text-paper-sub font-mono">History of all executed tasks</p>
                    </div>
                    <button onclick="app.navigate('home')" class="text-xs font-mono uppercase tracking-widest text-paper-sub hover:text-paper-ink transition-colors">
                        ESC / Back
                    </button>
                </header>

                <div class="bg-white rounded-xl border border-paper-ink/5 overflow-hidden shadow-sm flex-1 flex flex-col">
                    <!-- Table Header -->
                    <div class="grid grid-cols-12 gap-4 p-4 border-b border-paper-ink/5 bg-paper-bg/30 text-xs font-mono text-paper-sub uppercase tracking-widest">
                        <div class="col-span-2">Time</div>
                        <div class="col-span-4">Job Name</div>
                        <div class="col-span-2">Status</div>
                        <div class="col-span-2">Duration</div>
                        <div class="col-span-2 text-right">Action</div>
                    </div>

                    <!-- List -->
                    <div class="flex-1 overflow-y-auto hide-scrollbar">
                        <!-- Item 1 -->
                        <div class="grid grid-cols-12 gap-4 p-4 border-b border-paper-ink/5 hover:bg-paper-bg/50 transition-colors items-center group cursor-pointer" onclick="app.openRunDetail('run-1')">
                            <div class="col-span-2 text-paper-sub font-mono text-xs">10:41 AM</div>
                            <div class="col-span-4 font-medium text-paper-ink">Backup Assets</div>
                            <div class="col-span-2">
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                    SUCCESS
                                </span>
                            </div>
                            <div class="col-span-2 text-paper-sub text-sm">4.2s</div>
                            <div class="col-span-2 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                                <svg class="w-5 h-5 text-paper-sub inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        </div>

                        <!-- Item 2 -->
                        <div class="grid grid-cols-12 gap-4 p-4 border-b border-paper-ink/5 hover:bg-paper-bg/50 transition-colors items-center group cursor-pointer" onclick="app.openRunDetail('run-2')">
                            <div class="col-span-2 text-paper-sub font-mono text-xs">09:30 AM</div>
                            <div class="col-span-4 font-medium text-paper-ink">Daily Digest</div>
                            <div class="col-span-2">
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                    SUCCESS
                                </span>
                            </div>
                            <div class="col-span-2 text-paper-sub text-sm">1.8s</div>
                            <div class="col-span-2 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                                <svg class="w-5 h-5 text-paper-sub inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        </div>

                        <!-- Item 3 (Failed) -->
                        <div class="grid grid-cols-12 gap-4 p-4 border-b border-paper-ink/5 hover:bg-paper-bg/50 transition-colors items-center group cursor-pointer" onclick="app.openRunDetail('run-3')">
                            <div class="col-span-2 text-paper-sub font-mono text-xs">Yesterday</div>
                            <div class="col-span-4 font-medium text-paper-ink">Sync Calendar</div>
                            <div class="col-span-2">
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                    FAILED
                                </span>
                            </div>
                            <div class="col-span-2 text-paper-sub text-sm">30s</div>
                            <div class="col-span-2 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                                <svg class="w-5 h-5 text-paper-sub inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="p-4 border-t border-paper-ink/5 bg-paper-bg/30 flex justify-between items-center text-xs text-paper-sub">
                        <span>Showing 1-10 of 42</span>
                        <div class="flex gap-2">
                            <button class="px-3 py-1 bg-white border border-paper-ink/10 rounded hover:bg-paper-ink/5 disabled:opacity-50" disabled>Prev</button>
                            <button class="px-3 py-1 bg-white border border-paper-ink/10 rounded hover:bg-paper-ink/5">Next</button>
                        </div>
                    </div>
                </div>
             </div>
        </div>

        <!-- OVERLAY: Run Detail Slide-Over (Similar to Job Detail but read-only) -->
        <div id="run-detail" class="fixed inset-y-0 right-0 z-50 w-full md:w-[600px] bg-white shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col border-l border-paper-ink/5">
            <div class="p-6 border-b border-paper-ink/5 flex items-center justify-between bg-paper-bg/50">
                <div>
                    <div class="text-xs font-mono text-paper-sub uppercase tracking-widest mb-1">Run ID: 8821-AF</div>
                    <h2 class="text-2xl font-light text-paper-ink">Sync Calendar</h2>
                </div>
                <button onclick="app.closeRunDetail()" class="p-2 hover:bg-paper-ink/5 rounded-full transition-colors">
                    <svg class="w-6 h-6 text-paper-sub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6 space-y-8">
                <!-- Result Summary Block -->
                <div class="bg-red-50 border border-red-100 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-red-800 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Execution Failed
                    </h3>
                    <p class="text-sm text-red-600">TimeoutError: Google API did not respond within 30000ms.</p>
                </div>

                <!-- AI Summary (Simulated) -->
                <div>
                    <h3 class="text-sm font-medium text-paper-ink mb-2">AI Summary</h3>
                    <div class="text-sm text-paper-sub leading-relaxed">
                        The job attempted to sync calendar events but encountered a network timeout when reaching the Google Calendar API. This is likely a transient issue. No data was corrupted.
                    </div>
                </div>

                <!-- Full Output JSON -->
                <div>
                    <h3 class="text-sm font-medium text-paper-ink mb-3">Result Payload</h3>
                    <div class="bg-paper-bg p-4 rounded-lg border border-paper-ink/5 font-mono text-xs text-paper-sub overflow-x-auto">
                        <pre>{
  "error": {
    "code": "ETIMEDOUT",
    "service": "googleapis",
    "retries": 3
  },
  "timestamp": "2026-02-21T09:00:30Z"
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: System Status -->
        <div id="view-system" class="view-transition absolute inset-0 flex flex-col z-10 opacity-0 pointer-events-none translate-y-4 pt-20 px-4 md:px-20 pb-10 bg-paper-bg/95 backdrop-blur-sm">
             <div class="w-full max-w-5xl mx-auto h-full flex flex-col">
                <header class="flex items-end justify-between mb-10 border-b border-paper-ink/10 pb-4">
                    <div>
                        <h2 class="text-4xl font-light text-paper-ink mb-2">System Status</h2>
                        <p class="text-sm text-paper-sub font-mono">Uptime: 14d 03h 22m &bull; v0.9.4</p>
                    </div>
                    <button onclick="app.navigate('home')" class="text-xs font-mono uppercase tracking-widest text-paper-sub hover:text-paper-ink transition-colors">
                        ESC / Back
                    </button>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Service Health -->
                    <div class="bg-white p-6 rounded-xl border border-paper-ink/5 shadow-sm">
                        <h3 class="text-sm font-medium text-paper-ink mb-4">Services</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-paper-sub">API Server</span>
                                <span class="text-xs font-mono text-paper-success bg-paper-success/10 px-2 py-0.5 rounded">ONLINE</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-paper-sub">Telegram Worker</span>
                                <span class="text-xs font-mono text-paper-success bg-paper-success/10 px-2 py-0.5 rounded">ONLINE</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-paper-sub">Scheduler</span>
                                <span class="text-xs font-mono text-paper-success bg-paper-success/10 px-2 py-0.5 rounded">ONLINE</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-paper-sub">Voice Transcriber</span>
                                <span class="text-xs font-mono text-paper-sub bg-paper-ink/5 px-2 py-0.5 rounded">IDLE</span>
                            </div>
                        </div>
                    </div>

                    <!-- Resources -->
                    <div class="bg-white p-6 rounded-xl border border-paper-ink/5 shadow-sm">
                        <h3 class="text-sm font-medium text-paper-ink mb-4">Resources</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-paper-sub">CPU Load</span>
                                    <span class="font-mono text-paper-ink">12%</span>
                                </div>
                                <div class="h-1.5 w-full bg-paper-ink/5 rounded-full overflow-hidden">
                                    <div class="h-full bg-paper-ink w-[12%] rounded-full"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-paper-sub">Memory</span>
                                    <span class="font-mono text-paper-ink">4.2GB / 16GB</span>
                                </div>
                                <div class="h-1.5 w-full bg-paper-ink/5 rounded-full overflow-hidden">
                                    <div class="h-full bg-paper-accent w-[26%] rounded-full"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-paper-sub">Disk Space</span>
                                    <span class="font-mono text-paper-ink">45% Used</span>
                                </div>
                                <div class="h-1.5 w-full bg-paper-ink/5 rounded-full overflow-hidden">
                                    <div class="h-full bg-paper-ink w-[45%] rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Environment Info -->
                    <div class="bg-white p-6 rounded-xl border border-paper-ink/5 shadow-sm">
                        <h3 class="text-sm font-medium text-paper-ink mb-4">Environment</h3>
                        <div class="space-y-2 text-xs font-mono text-paper-sub">
                            <div class="flex justify-between border-b border-paper-ink/5 pb-2">
                                <span>NODE_ENV</span>
                                <span class="text-paper-ink">production</span>
                            </div>
                            <div class="flex justify-between border-b border-paper-ink/5 pb-2">
                                <span>PLATFORM</span>
                                <span class="text-paper-ink">darwin</span>
                            </div>
                            <div class="flex justify-between border-b border-paper-ink/5 pb-2">
                                <span>OTTO_HOME</span>
                                <span class="text-paper-ink">~/.otto</span>
                            </div>
                            <div class="mt-4 pt-2">
                                <button class="w-full py-2 bg-paper-ink/5 hover:bg-paper-ink/10 text-paper-ink rounded transition-colors text-center" onclick="app.navigate('settings')">
                                    Manage Environment
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
             </div>
        </div>

        <!-- VIEW: Settings -->
        <div id="view-settings" class="view-transition absolute inset-0 flex flex-col z-10 opacity-0 pointer-events-none translate-y-4 pt-20 px-4 md:px-20 pb-10 bg-paper-bg/95 backdrop-blur-sm">
             <div class="w-full max-w-3xl mx-auto h-full flex flex-col">
                <header class="flex items-end justify-between mb-10 border-b border-paper-ink/10 pb-4">
                    <div>
                        <h2 class="text-4xl font-light text-paper-ink mb-2">Configuration</h2>
                        <p class="text-sm text-paper-sub font-mono">Manage runtime variables & feature flags</p>
                    </div>
                    <button onclick="app.navigate('home')" class="text-xs font-mono uppercase tracking-widest text-paper-sub hover:text-paper-ink transition-colors">
                        ESC / Back
                    </button>
                </header>

                <div class="bg-white rounded-xl border border-paper-ink/5 overflow-hidden">
                    <div class="p-6 border-b border-paper-ink/5">
                        <h3 class="text-lg font-light text-paper-ink mb-4">Feature Flags</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm font-medium text-paper-ink">Telegram Integration</div>
                                    <div class="text-xs text-paper-sub">Enable bot communication bridge</div>
                                </div>
                                <button class="w-12 h-6 rounded-full bg-paper-success relative transition-colors duration-300">
                                    <div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full shadow-sm"></div>
                                </button>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm font-medium text-paper-ink">Voice Transcription</div>
                                    <div class="text-xs text-paper-sub">Use local Whisper model for audio</div>
                                </div>
                                <button class="w-12 h-6 rounded-full bg-paper-ink/10 relative transition-colors duration-300">
                                    <div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-sm"></div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 bg-paper-bg/30">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-light text-paper-ink">Environment Variables</h3>
                            <button class="text-xs bg-paper-ink text-white px-3 py-1.5 rounded hover:bg-paper-ink/90 transition-colors">+ Add New</button>
                        </div>
                        
                        <div class="space-y-2 font-mono text-xs">
                            <div class="flex items-center gap-2 group">
                                <input type="text" value="TELEGRAM_BOT_TOKEN" class="bg-white border border-paper-ink/10 rounded px-2 py-1.5 w-1/3 text-paper-sub" readonly>
                                <input type="password" value="************************" class="bg-white border border-paper-ink/10 rounded px-2 py-1.5 flex-1 text-paper-ink" readonly>
                                <button class="text-paper-accent opacity-0 group-hover:opacity-100 transition-opacity">Delete</button>
                            </div>
                            <div class="flex items-center gap-2 group">
                                <input type="text" value="OPENAI_API_KEY" class="bg-white border border-paper-ink/10 rounded px-2 py-1.5 w-1/3 text-paper-sub" readonly>
                                <input type="password" value="sk-proj-****************" class="bg-white border border-paper-ink/10 rounded px-2 py-1.5 flex-1 text-paper-ink" readonly>
                                <button class="text-paper-accent opacity-0 group-hover:opacity-100 transition-opacity">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
             </div>
        </div>

        <!-- OVERLAY: Command Palette (Global) -->
        <div id="command-palette" class="fixed inset-0 z-50 flex flex-col md:items-start md:justify-center md:pt-[20vh] px-0 md:px-4 opacity-0 pointer-events-none transition-opacity duration-200">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-paper-bg/80 backdrop-blur-sm transition-opacity duration-300" onclick="app.closeCommandPalette()"></div>
            
            <!-- Panel -->
            <div class="relative w-full md:max-w-xl bg-white rounded-t-3xl md:rounded-2xl shadow-2xl border-t border-x md:border border-paper-ink/5 overflow-hidden transform translate-y-full md:translate-y-0 md:scale-95 transition-transform duration-300 md:mx-auto mt-auto md:mt-0 h-[80vh] md:h-auto pb-safe md:pb-0 flex flex-col" id="cmd-panel">
                
                <!-- Input -->
                <div class="flex items-center border-b border-paper-ink/5 p-4 md:p-4 sticky top-0 bg-white z-10">
                    <button class="md:hidden mr-3 p-2 text-paper-sub hover:text-paper-ink" onclick="app.closeCommandPalette()">
                         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <svg class="w-5 h-5 text-paper-sub mr-3 hidden md:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    <input 
                        type="text" 
                        id="cmd-input"
                        placeholder="What would you like to do?" 
                        class="flex-1 bg-transparent border-none outline-none text-lg md:text-xl font-light text-paper-ink placeholder-paper-sub/40 h-10 md:h-8"
                        autocomplete="off"
                    >
                    <div class="text-[10px] font-mono text-paper-sub border border-paper-ink/10 rounded px-1.5 py-0.5 hidden md:block">ESC</div>
                </div>

                <!-- Results -->
                <div class="max-h-[60vh] overflow-y-auto py-2" id="cmd-results">
                    
                    <div class="px-4 py-2 text-[10px] font-mono uppercase tracking-widest text-paper-sub/50">Jump to</div>
                    
                    <button class="w-full px-4 py-3 flex items-center justify-between hover:bg-paper-ink/5 group transition-colors focus:bg-paper-ink/5 focus:outline-none cmd-item" onclick="app.navigate('jobs'); app.closeCommandPalette()">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-paper-ink/5 flex items-center justify-center text-paper-sub group-hover:text-paper-ink group-focus:text-paper-ink">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                            </div>
                            <span class="text-paper-ink font-light">Job Queue</span>
                        </div>
                        <span class="text-xs text-paper-sub font-mono">G J</span>
                    </button>

                    <button class="w-full px-4 py-3 flex items-center justify-between hover:bg-paper-ink/5 group transition-colors focus:bg-paper-ink/5 focus:outline-none cmd-item" onclick="app.navigate('chat'); app.closeCommandPalette()">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-paper-ink/5 flex items-center justify-center text-paper-sub group-hover:text-paper-ink group-focus:text-paper-ink">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
                            </div>
                            <span class="text-paper-ink font-light">Chat with Otto</span>
                        </div>
                        <span class="text-xs text-paper-sub font-mono">G C</span>
                    </button>

                    <button class="w-full px-4 py-3 flex items-center justify-between hover:bg-paper-ink/5 group transition-colors focus:bg-paper-ink/5 focus:outline-none cmd-item">
                        <div class="flex items-center gap-3">
                             <div class="w-8 h-8 rounded-lg bg-paper-ink/5 flex items-center justify-center text-paper-sub group-hover:text-paper-ink group-focus:text-paper-ink">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            </div>
                            <span class="text-paper-ink font-light">Settings</span>
                        </div>
                        <span class="text-xs text-paper-sub font-mono">G S</span>
                    </button>

                    <div class="px-4 py-2 mt-2 text-[10px] font-mono uppercase tracking-widest text-paper-sub/50">Quick Actions</div>

                    <button class="w-full px-4 py-3 flex items-center justify-between hover:bg-paper-ink/5 group transition-colors focus:bg-paper-ink/5 focus:outline-none cmd-item" onclick="app.navigate('audit'); app.closeCommandPalette()">
                        <div class="flex items-center gap-3">
                             <div class="w-8 h-8 rounded-lg bg-paper-ink/5 flex items-center justify-center text-paper-sub group-hover:text-paper-ink group-focus:text-paper-ink">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                            </div>
                            <span class="text-paper-ink font-light">Audit Trail</span>
                        </div>
                        <span class="text-xs text-paper-sub font-mono">G A</span>
                    </button>

                    <button class="w-full px-4 py-3 flex items-center justify-between hover:bg-paper-ink/5 group transition-colors focus:bg-paper-ink/5 focus:outline-none cmd-item" onclick="app.navigate('system'); app.closeCommandPalette()">
                        <div class="flex items-center gap-3">
                             <div class="w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center text-green-600 group-hover:text-green-700">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <span class="text-paper-ink font-light">System Status</span>
                        </div>
                    </button>

                    <button class="w-full px-4 py-3 flex items-center justify-between hover:bg-paper-ink/5 group transition-colors focus:bg-paper-ink/5 focus:outline-none cmd-item" onclick="app.navigate('settings'); app.closeCommandPalette()">
                        <div class="flex items-center gap-3">
                             <div class="w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-600 group-hover:text-blue-700">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            </div>
                            <span class="text-paper-ink font-light">Settings</span>
                        </div>
                    </button>

                    <div id="cmd-empty" class="hidden px-4 py-8 text-center text-sm text-paper-sub font-light">
                        No matching actions.
                    </div>

                </div>
            </div>
        </div>

    </div>

    <!-- Application Logic -->
    <script>
        const app = {
            state: {
                currentView: 'home',
                isDark: false,
                isCmdOpen: false
            },

            init() {
                // Keyboard Listeners
                document.addEventListener('keydown', (e) => {
                    // CMD+K or CTRL+K
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        this.openCommandPalette();
                    }
                    // ESC
                    if (e.key === 'Escape') {
                        if (this.state.isCmdOpen) {
                            this.closeCommandPalette();
                        } else if (this.state.currentView !== 'home') {
                            this.navigate('home');
                        }
                    }
                    // Keyboard Nav in Palette
                    if (this.state.isCmdOpen) {
                        this.handlePaletteNav(e);
                    }
                });

                const cmdInput = document.getElementById('cmd-input');
                if (cmdInput) {
                    cmdInput.addEventListener('input', (e) => {
                        this.filterCommandItems(e.target.value);
                    });
                }
            },

            getVisibleCmdItems() {
                return Array.from(document.querySelectorAll('.cmd-item')).filter((item) => {
                    return !item.classList.contains('hidden');
                });
            },

            filterCommandItems(rawQuery) {
                const query = rawQuery.trim().toLowerCase();
                const items = Array.from(document.querySelectorAll('.cmd-item'));
                let visibleCount = 0;

                items.forEach((item) => {
                    const label = item.innerText.toLowerCase();
                    const match = query.length === 0 || label.includes(query);
                    item.classList.toggle('hidden', !match);
                    if (match) visibleCount += 1;
                });

                const empty = document.getElementById('cmd-empty');
                if (empty) {
                    empty.classList.toggle('hidden', visibleCount > 0);
                }

                this.setActiveCmdItem(0);
            },

            setActiveCmdItem(index) {
                const items = this.getVisibleCmdItems();
                items.forEach((item, i) => {
                    item.classList.toggle('bg-paper-ink/5', i === index);
                });
            },

            navigate(viewId) {
                // Hide all views
                document.querySelectorAll('.view-transition').forEach(el => {
                    el.style.opacity = '0';
                    el.style.pointerEvents = 'none';
                    el.style.transform = 'translateY(10px)';
                });

                // Show target view
                const target = document.getElementById(`view-${viewId}`);
                if (target) {
                    // Small delay for clean transition
                    setTimeout(() => {
                        target.style.opacity = '1';
                        target.style.pointerEvents = 'auto';
                        target.style.transform = 'translateY(0)';
                    }, 50);
                }
                
                this.state.currentView = viewId;
            },

            openJobDetail(jobId) {
                const drawer = document.getElementById('job-detail');
                drawer.classList.remove('translate-x-full');
            },

            closeJobDetail() {
                const drawer = document.getElementById('job-detail');
                drawer.classList.add('translate-x-full');
            },

            openRunDetail(runId) {
                const drawer = document.getElementById('run-detail');
                drawer.classList.remove('translate-x-full');
            },

            closeRunDetail() {
                const drawer = document.getElementById('run-detail');
                drawer.classList.add('translate-x-full');
            },

            toggleTheme() {
                this.state.isDark = !this.state.isDark;
                const html = document.documentElement;
                if (this.state.isDark) {
                    html.classList.add('dark');
                    // In a real app, we'd swap CSS variables or classes here
                    // For prototype, we'll invert styles manually or use a simple filter for effect
                    document.body.style.filter = 'invert(1) hue-rotate(180deg)';
                } else {
                    html.classList.remove('dark');
                    document.body.style.filter = 'none';
                }
            },

            openCommandPalette() {
                const palette = document.getElementById('command-palette');
                const panel = document.getElementById('cmd-panel');
                const input = document.getElementById('cmd-input');
                
                palette.classList.remove('opacity-0', 'pointer-events-none');
                
                // Desktop
                panel.classList.remove('scale-95');
                panel.classList.add('scale-100');
                
                // Mobile Slide Up
                panel.classList.remove('translate-y-full');
                panel.classList.add('translate-y-0');
                
                if (input) {
                    input.value = '';
                    this.filterCommandItems('');
                }

                setTimeout(() => input && input.focus(), 100);
                this.state.isCmdOpen = true;
            },

            closeCommandPalette() {
                const palette = document.getElementById('command-palette');
                const panel = document.getElementById('cmd-panel');
                
                palette.classList.add('opacity-0', 'pointer-events-none');
                
                // Desktop
                panel.classList.remove('scale-100');
                panel.classList.add('scale-95');

                // Mobile Slide Down
                panel.classList.remove('translate-y-0');
                panel.classList.add('translate-y-full');
                
                this.state.isCmdOpen = false;
            },

            handlePaletteNav(e) {
                const items = this.getVisibleCmdItems();
                const activeElement = document.activeElement;
                let currentIndex = Array.from(items).indexOf(activeElement);

                if (items.length === 0) {
                    return;
                }

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    const nextIndex = (currentIndex + 1) % items.length;
                    this.setActiveCmdItem(nextIndex);
                    items[nextIndex].focus();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    const prevIndex = (currentIndex - 1 + items.length) % items.length;
                    this.setActiveCmdItem(prevIndex);
                    items[prevIndex].focus();
                } else if (e.key === 'Enter') {
                    // If input is focused and enter is pressed, select first filtered item
                    if (activeElement.id === 'cmd-input') {
                        e.preventDefault();
                        items[0].click();
                    }
                }
            }
        };

        // Boot
        app.init();
    </script>
</body>
</html>
